## Backend — Step-by-step Plan (Simple and Clear)

Цель: пациент один раз вводит свой персональный код в приложении. Дальше приложение при каждой отправке анкеты добавляет этот код в запрос (в заголовок `X-Patient-Code` или в тело). На бэкенде все записи хранятся под этим кодом.

### 1. Определиться с хранилищем
- Выбрать простой Postgres (например, Supabase) — таблицы, индексы, резервные копии.

### 2. Таблицы в базе данных
- `patients` — хранит только код пациента (без персональных данных).
- `daily_entries` — дневные записи.
- `weekly_entries` — недельные записи (LARS).
- `monthly_entries` — месячные записи (QoL).

### 3. Выдача кода пациенту
- Врач генерирует код и выдаёт пациенту (врачебный интерфейс позже; пока можно вручную/через админку).

### 4. Экран ввода кода в приложении
- Одно поле «Enter your code» + кнопка «Continue».
- Сохраняем код локально, чтобы не вводить его каждый раз.
- В профиле — кнопка «Logout» (очищает код и возвращает на экран ввода).

### 5. Передача кода в каждом запросе
- Каждый запрос с анкетой отправляет код:
  - Заголовок: `X-Patient-Code: <code>` (или поле `patient_code` в теле — выбрать один вариант и всегда придерживаться его).

### 6. Эндпоинты (минимум)
- `POST /sendDaily` — приём дневной анкеты.
- `POST /sendWeekly` — приём недельной анкеты (LARS).
- `POST /sendMonthly` — приём месячной анкеты (QoL).
- (Опционально) `GET /history` — вернуть данные для графиков.
- (Опционально) `GET /me` — вернуть краткую сводку (последние даты и т.п.).

### 7. Логика на сервере (просто)
- Проверить, что код присутствует и корректен по формату.
- Найти пациента по коду, если нет — создать.
- Записать анкету в соответствующую таблицу, привязав к пациенту.
- Вернуть ответ `204` (успех без тела).

### 8. Мини-защита и стабильность
- Лимит по частоте запросов (чтобы не злоупотребляли).
- Простая проверка входных данных (числа в разумных диапазонах).
- Логи ошибок и мониторинг (минимально).

### 9. Отдача данных для графиков (по необходимости)
- Вернуть списки записей по датам для дневных/недельных/месячных графиков.

### 10. Развёртывание
- Подготовить окружения: тестовое и прод.
- Задать переменные окружения и доступы.
- Прогнать «smoke»-проверку: отправка каждой анкеты и получение истории.

### Пояснение про токены
- В этой схеме токены не нужны: код передаётся каждый раз, сервер определяет пациента только по коду.
- Если позже понадобится усилить безопасность — можно добавить токен без изменения базовой логики.
